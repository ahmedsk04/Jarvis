:root{
  /* layout */
  --chat-size: 64px;
  --chat-right: 20px;
  --chat-bottom: 20px;
  --open-w: min(400px, 92vw);
  --open-h: min(640px, 70vh);
  --duration: 800ms;

  /* launcher gradient */
  --grad-a: #00f0ff;
  --grad-b: #8b5cf6;

  /* default = dark */
  --chat-bg: linear-gradient(180deg,#0b1220,#0a0f1a);
  --chat-border: rgba(255,255,255,.08);
  --chat-text: #fff;

  --bubble-me: rgba(59,130,246,.16);
  --bubble-me-border: rgba(59,130,246,.35);
  --bubble-me-text: #e8f1ff;

  --bubble-bot: rgba(255,255,255,.06);
  --bubble-bot-border: rgba(255,255,255,.10);
  --bubble-bot-text: #fff;

  --hint-bg: #fff;
  --hint-text: #001018;
  --hint-border: rgba(0,0,0,.06);

  --shadow-strong: rgba(0,0,0,.65);
  --shadow-medium: rgba(0,0,0,.55);
  --shadow-soft: rgba(139,92,246,.28);
}

/* Light theme (JS adds .morph-portal.light based on <html>.dark) */
.morph-portal.light{
  --chat-bg: #ffffff;
  --chat-border: rgba(0,0,0,.08);
  --chat-text: #111;

  --bubble-me: rgba(59,130,246,.10);
  --bubble-me-border: rgba(59,130,246,.25);
  --bubble-me-text: #0b1f44;

  --bubble-bot: rgba(0,0,0,.05);
  --bubble-bot-border: rgba(0,0,0,.12);
  --bubble-bot-text: #111;

  --hint-bg: #111;
  --hint-text: #ffffff;
  --hint-border: rgba(0,0,0,.35);
}

/* -------- Portal & Backdrop -------- */
.morph-portal{
  position: fixed;
  inset: 0;
  z-index: 2147483600;           /* very high, above headers */
  pointer-events: none;          /* we’ll re-enable on widgets */
}
.morph-portal *{ box-sizing: border-box; }

.mc-backdrop{
  position: fixed; inset: 0;
  background: rgba(0,0,0,.25);
  opacity: 0; pointer-events: none;
  transition: opacity .24s ease;
}
.mc-backdrop.show{ opacity: 1; pointer-events: auto; }

/* -------- Launcher (stays bottom-right, never hides) -------- */
#morphChat{
  position: fixed;
  right: var(--chat-right);
  bottom: var(--chat-bottom);
  width: var(--chat-size);
  height: var(--chat-size);
  border-radius: 999px;
  cursor: pointer;
  pointer-events: auto;           /* clickable even when portal pointer-events none */
  display: grid; place-items: center;
  isolation: isolate;
  background: radial-gradient(120% 120% at 70% 20%, var(--grad-a), var(--grad-b));
  box-shadow: 0 18px 56px var(--shadow-medium);
  transform-origin: bottom right;
  outline: none;
  transition: transform .18s ease, box-shadow .18s ease;
}
#morphChat:hover{ transform: translateY(-1px); }
#morphChat:focus-visible{
  box-shadow: 0 0 0 3px rgba(255,255,255,.55), 0 18px 56px var(--shadow-medium);
}

#morphChat .iconWrap{ display: grid; place-items: center; color: #fff; }
#morphChat .icon{ width: 24px; height: 24px; filter: drop-shadow(0 2px 4px rgba(0,0,0,.36)); }

/* Hover hint (only when closed) */
#morphChat .hint{
  position: absolute;
  right: calc(100% + 10px);
  bottom: 50%;
  transform: translateY(50%) translateX(6px);
  opacity: 0; pointer-events: none;
  background: var(--hint-bg); color: var(--hint-text);
  font: 700 13px/1 system-ui;
  padding: 8px 10px; white-space: nowrap;
  border-radius: 12px; border: 1px solid var(--hint-border);
  box-shadow: 0 8px 20px rgba(0,0,0,.28);
  transition: opacity .24s ease, transform .24s ease;
}
#morphChat .hint:after{
  content:""; position:absolute; right:-6px; top:50%;
  transform: translateY(-50%) rotate(45deg);
  width:12px; height:12px; background: var(--hint-bg);
  border:1px solid var(--hint-border); border-left:none; border-bottom:none;
}
#morphChat:not(.open):hover .hint,
#morphChat:not(.open):focus-visible .hint{
  opacity: 1; transform: translateY(50%) translateX(0);
}

/* -------- Morph container & panel -------- */
/* We DO NOT resize the launcher into a rectangle (prevents “button disappearing” feel).
   Instead, we keep the circular launcher and show a floating panel above it. */
#morphChat .content{
  position: fixed;
  right: calc(var(--chat-right));
  bottom: calc(var(--chat-bottom) + var(--chat-size) + 12px);  /* panel above the button */
  width: var(--open-w);
  height: var(--open-h);
  background: var(--chat-bg);
  border: 1px solid var(--chat-border);
  border-radius: 16px;
  overflow: hidden;
  color: var(--chat-text);
  transform-origin: 100% 100%;
  transform: translateY(8px) scale(.96);
  opacity: 0; pointer-events: none;
  box-shadow: 0 30px 100px var(--shadow-strong);
  transition: opacity .24s ease, transform .24s cubic-bezier(.2,.9,.25,1);
  display: grid;
  grid-template-rows: 50px 1fr 64px;
  will-change: transform, opacity;
}

/* Open state: panel becomes interactive; launcher remains visible */
#morphChat.open .content{
  opacity: 1; transform: none; pointer-events: auto;
}

/* Optional zoom flavors (kept for parity with JS flags) */
#morphChat.zooming-in{ transform: scale(.98); }
#morphChat.zooming-out{ transform: scale(.98); }

/* -------- Header / Body / Input -------- */
.mc-hdr{
  display: flex; align-items: center; justify-content: space-between;
  padding: 10px 12px; border-bottom: 1px solid var(--chat-border);
  font: 800 14px system-ui;
}
.mc-actions button{
  background: none; border: 0; color: inherit; opacity: .9;
  cursor: pointer; font-size: 18px;
}
.mc-actions button:hover{ opacity: 1; }

.mc-body{
  padding: 12px; overflow: auto;
  scrollbar-width: thin; scrollbar-color: rgba(255,255,255,.25) transparent;
}
.mc-body::-webkit-scrollbar{ width: 10px; }
.mc-body::-webkit-scrollbar-thumb{ background: rgba(127,127,127,.25); border-radius: 999px; }

.mc-msg{
  max-width: 78%;
  margin: 6px 0;
  font: 500 14px/1.45 system-ui;
  display: flex;
}
.mc-msg .bubble{
  padding: 10px 12px;
  border-radius: 12px;
  border: 1px solid transparent;
}
.mc-msg.me{ justify-content: flex-end; }
.mc-msg.me .bubble{
  background: var(--bubble-me);
  border-color: var(--bubble-me-border);
  color: var(--bubble-me-text);
}
.mc-msg.bot{ justify-content: flex-start; }
.mc-msg.bot .bubble{
  background: var(--bubble-bot);
  border-color: var(--bubble-bot-border);
  color: var(--bubble-bot-text);
}

/* Input area */
.mc-input{
  display: flex; gap: 8px; align-items: end;
  padding: 10px; border-top: 1px solid var(--chat-border);
}
.mc-input textarea{
  flex: 1; min-height: 44px; max-height: 140px; resize: vertical;
  padding: 10px 12px; border-radius: 10px; outline: none;
  border: 1px solid rgba(127,127,127,.16);
  background: rgba(15,23,42,.08);
  color: inherit;
}
.morph-portal.light .mc-input textarea{ background: rgba(0,0,0,.04); }
.mc-input textarea::placeholder{ color: rgba(127,127,127,.7); }
.mc-input textarea:focus{
  border-color: rgba(59,130,246,.45);
  box-shadow: 0 0 0 3px rgba(59,130,246,.18);
}
.mc-send{
  min-width: 92px; height: 44px; border-radius: 10px; border: 0; cursor: pointer;
  background: radial-gradient(120% 120% at 70% 20%, var(--grad-a) 0%, var(--grad-b) 85%);
  color: #001018; font: 800 14px system-ui; box-shadow: 0 8px 18px var(--shadow-soft);
}
.mc-send:disabled{ opacity: .6; cursor: not-allowed; }

/* -------- Reduced motion -------- */
@media (prefers-reduced-motion: reduce){
  .mc-backdrop, #morphChat, #morphChat .content{
    transition: none !important;
  }
}

/* -------- Mobile tweaks -------- */
@media (max-width: 520px){
  :root{
    --chat-size: 58px;
    --chat-right: 14px;
    --chat-bottom: 14px;
  }
  #morphChat .content{
    right: 12px;
    width: calc(100vw - 24px);
    height: min(620px, 65vh);
  }
}

/* -------- Safety z-index helpers (optional) -------- */
header, .navbar, .sticky, .fixed-top{
  z-index: 1000;
}
